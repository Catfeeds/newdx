
<link rel="stylesheet" type="text/css" href="data/cache/style_{STYLEID}_forum_post.css?{VERHASH}" />
<script type="text/javascript" src="{$_G['setting']['jspath']}forum_post.js?{VERHASH}"></script>

			<!--{if !empty($_G['gp_modthreadkey'])}--><input type="hidden" name="modthreadkey" id="modthreadkey" value="$_G['gp_modthreadkey']" /><!--{/if}-->
			<input type="hidden" name="wysiwyg" id="{$editorid}_mode" value="$editormode" />
			<!--{if $_G[gp_action] == 'reply'}-->
				<input type="hidden" name="noticeauthor" value="$noticeauthor" />
				<input type="hidden" name="noticetrimstr" value="$noticetrimstr" />
				<input type="hidden" name="noticeauthormsg" value="$noticeauthormsg" />
				<!--{if $_G[gp_reppost]}-->
					<input type="hidden" name="reppost" value="$_G[gp_reppost]" />
				<!--{elseif $_G[gp_repquote]}-->
					<input type="hidden" name="reppost" value="$_G[gp_repquote]" />
				<!--{/if}-->
			<!--{/if}-->
			<!--{if $_G[gp_action] == 'edit'}-->
				<input type="hidden" name="fid" id="fid" value="$_G[fid]" />
				<input type="hidden" name="tid" value="$_G[tid]" />
				<input type="hidden" name="pid" value="$pid" />
				<input type="hidden" name="page" value="$_G[gp_page]" />
			<!--{/if}-->
			<!--{if $special}-->
				<input type="hidden" name="special" value="$special" />
			<!--{/if}-->
			<!--{if $specialextra}-->
				<input type="hidden" name="specialextra" value="$specialextra" />
			<!--{/if}-->
			<div class="bm bw0 cl"{if !$showthreadsorts && !$adveditor} id="editorbox"{/if}>
				<div id="postbox">
			<!--{if $showthreadsorts}-->
				<div class="exfm cl" id="threadsorts">
					<span id="threadsortswait"></span>
				</div>
			<!--{elseif $adveditor}-->
				<!--{if $special == 1}--><!--{template forum/post_poll}-->
				<!--{elseif $special == 2 && ($_G[gp_action] != 'edit' || ($_G[gp_action] == 'edit' && ($thread['authorid'] == $_G['uid'] && $_G['group']['allowposttrade'] || $_G['group']['allowedittrade'])))}--><p class="xg1">{lang post_message1}</p><!--{template forum/post_trade}-->
				<!--{elseif $special == 3}--><!--{template forum/post_reward}-->
				<!--{elseif $special == 4}--><!--{template forum/post_activity}-->
				<!--{elseif $special == 5}--><!--{template forum/post_debate}-->
				<!--{elseif $specialextra}--><div class="specialpost s_clear">$threadplughtml</div>
				<!--{/if}-->
			<!--{/if}-->
			<div id="rstnotice" style="display:none"></div>
			<div class="edt" id="{$editorid}_body">
				<div id="{$editorid}_controls" class="bar">
					<div class="y">
						<div class="b2r nbl nbr" id="{$editorid}_adv_5">
							<p>
								<a id="{$editorid}_undo" title="{lang e_undo}">Undo</a>
							</p>
							<p>
								<a id="{$editorid}_redo" title="{lang e_redo}">Redo</a>
							</p>
						</div>
						<div class="z">
							<span class="mbn"><a id="{$editorid}_fullswitcher"></a><a id="{$editorid}_simple"></a></span>
							<label id="{$editorid}_switcher" class="bar_swch ptn"><input id="{$editorid}_switchercheck" type="checkbox" class="pc" name="checkbox" value="0" {if !$editor[editormode]}checked="checked"{/if} onclick="switchEditor(this.checked?0:1)" />{lang code}</label>
						</div>
					</div>
					<!--{if !empty($_G[setting][pluginhooks][post_editorctrl_right])}-->
						<div class="y"><!--{hook/post_editorctrl_right}--></div>
					<!--{/if}-->
					<div id="{$editorid}_button" class="btn cl">
						<div class="b1r" id="{$editorid}_adv_s0">
							<a id="{$editorid}_paste" title="{lang e_paste}">{lang e_paste}</a>
						</div>
						<div class="b2r nbr" id="{$editorid}_adv_s2">
							<a id="{$editorid}_fontname" class="dp" title="{lang e_fontname}"><span id="{$editorid}_font">{lang e_font}</span></a>
							<a id="{$editorid}_fontsize" class="dp" title="{lang e_fontsize}"><span id="{$editorid}_size">{lang e_size}</span></a>
							<br id="{$editorid}_adv_1" />
							<a id="{$editorid}_bold" title="{lang e_bold}">B</a>
							<a id="{$editorid}_italic" title="{lang e_italic}">I</a>
							<a id="{$editorid}_underline" title="{lang e_underline}">U</a>
							<a id="{$editorid}_forecolor" title="{lang e_forecolor}">Color</a>
							<a id="{$editorid}_url" title="{lang e_url}">Url</a>
							<span id="{$editorid}_adv_8">
							<a id="{$editorid}_unlink" title="{lang e_unlink}">Unlink</a>
							<a id="{$editorid}_inserthorizontalrule" title="{lang e_hr_title}">Hr</a>
							</span>
						</div>
						<div class="b2r nbl" id="{$editorid}_adv_2">
							<p id="{$editorid}_adv_3">
								<a id="{$editorid}_tbl" title="{lang e_table}">Table</a>
							</p>
							<p>
								<a id="{$editorid}_removeformat" title="{lang e_removeformat}">Removeformat</a>
							</p>
						</div>
						<div class="b2r">
							<p>
								<a id="{$editorid}_justifyleft" title="{lang e_left}">Left</a>
								<a id="{$editorid}_justifycenter" title="{lang e_center}">Center</a>
								<a id="{$editorid}_justifyright" title="{lang e_right}">Right</a>
							</p>
							<p id="{$editorid}_adv_4">
								<a id="{$editorid}_autotypeset" title="{lang e_autotypeset}">Autotypeset</a>
								<a id="{$editorid}_insertorderedlist" title="{lang e_orderedlist}">Orderedlist</a>
								<a id="{$editorid}_insertunorderedlist" title="{lang e_unorderedlist}">Unorderedlist</a>
							</p>
						</div>
						<div class="b1r" id="{$editorid}_adv_s1" style="display: none;">
							<a id="{$editorid}_sml" title="{lang e_smilies_title}">{lang e_smilies}</a>
							<div id="{$editorid}_imagen" style="display:none">!</div>
							<a id="{$editorid}_image" title="{lang e_image_title}">{lang e_image}</a>
							<!--{if $_G['group']['allowpostattach']}-->
								<div id="{$editorid}_attachn" style="display:none">!</div>
								<a id="{$editorid}_attach" title="{lang e_attach_title}">{lang e_attach}</a>
							<!--{/if}-->
							<!--{if $_G['forum']['allowmediacode']}-->
								<a id="{$editorid}_aud" title="{lang e_audio_title}">{lang e_audio}</a>
								<a id="{$editorid}_vid" title="{lang e_video_title}">{lang e_video}</a>

							<!--{/if}-->
							<!--{hook/post_editorctrl_left}-->
						</div>
						<div class="b2r{if $_G['cache']['bbcodes_display'][$_G['groupid']]} nbr{/if}" id="{$editorid}_adv_6">
							<p>
								<a id="{$editorid}_code" title="{lang e_code_title}">{lang e_code}</a>
								<!--{if $isfirstpost && $_G['group']['allowhidecode']}--><a id="{$editorid}_hide" title="{lang e_hide}">Hide</a><!--{/if}-->
							</p>
							<p>
								<a id="{$editorid}_quote" title="{lang e_quote_title}">{lang e_quote}</a>
								<!--{if $isfirstpost}--><a id="{$editorid}_free" title="{lang e_free}">Free</a><!--{/if}-->
							</p>
						</div>
						<!--{if $_G['cache']['bbcodes_display'][$_G['groupid']]}-->
						<div class="b2r nbl">
							<!--{loop $_G['cache']['bbcodes_display'][$_G['groupid']] $tag $bbcode}-->
								<!--{if $bbcode['i'] % 2 != 0}--><a id="{$editorid}_cst{$bbcode[params]}_$tag" class="cst" title="$bbcode[explanation]"><img src="{STATICURL}image/common/$bbcode[icon]" title="$bbcode[explanation]" alt="$tag" /></a><!--{/if}-->
							<!--{/loop}-->
							<!--{hook/post_editorctrl_top}-->
							<br id="{$editorid}_adv_7" />
							<!--{loop $_G['cache']['bbcodes_display'][$_G['groupid']] $tag $bbcode}-->
								<!--{if $bbcode['i'] % 2 == 0}--><a id="{$editorid}_cst{$bbcode[params]}_$tag" class="cst" title="$bbcode[explanation]"><img src="{STATICURL}image/common/$bbcode[icon]" title="$bbcode[explanation]" alt="$tag" /></a><!--{/if}-->
							<!--{/loop}-->
							<!--{hook/post_editorctrl_bottom}-->
						</div>
						<!--{/if}-->
						<!--{if $_G['setting']['magicstatus'] && !empty($_G['setting']['magics']['doodle'])}-->
							<div class="b2r">
								<a id="a_magic_doodle" href="home.php?mod=magic&mid=doodle&showid=comment_doodle&target={$editorid}_textarea&from=forumeditor" class="cst" onclick="showWindow(this.id, this.href, 'get', 0)"><img src="{STATICURL}image/magic/doodle.small.gif" alt="doodle" title="$_G['setting']['magics']['doodle']" style="margin-top:2px" /></a>
							</div>
						<!--{/if}-->
					</div>
				</div>
                <style>
                #upload_newimage_tools h4 span{padding: 0 5px;display: block;float: left;cursor:pointer;font-size:13px;font-weight: bold;border:1px solid #F6F6F6;border-bottom-width:1px;border-bottom-color: #CCC;margin-right:5px;position: relative;top: 1px;font-family: Arial,PMingLiU,sans-serif;}
                #upload_newimage_tools h4{height:30px;line-height: 28px;padding-top:2px;padding-left:5px;border-bottom: 1px solid #CCC;background:#FFF}
                #tips_limit{position: absolute;background:#FFF;border:5px solid #CCC;display: none;}
				#uploadtips{color:blue;text-align:center;}
                </style>
                <div id="tips_limit">
                    <div class="notice upnf">
                        照片可以多个选取，批量上传
    						<br />照片大小：小于8.7MB,边长小于2500像素，否则无法上传。
                        <!--{if $_G['group']['maxattachnum'] || $_G['group']['maxsizeperday']}-->
                        <br />{lang attachment_limit}: <!--{if $_G['group']['maxattachnum']}--><strong>$allowuploadnum</strong> {lang attachment_unit}&nbsp;<!--{/if}--><!--{if $_G['group']['maxsizeperday']}--><strong>$allowuploadsize</strong>&nbsp;<!--{/if}-->
    					<!--{/if}-->
    					<!--{if $imgexts}-->
    						<br />{lang attachment_allow_exts}: <strong>$imgexts</strong>&nbsp;
    					<!--{/if}-->
    					<!--{if $creditstring}-->
    						<br /><a href="forum.php?mod=faq&action=credits&fid=$_G[fid]" target="_blank" title="{lang credits_policy}">{lang post_credits_postattach}&nbsp;$creditstring</a>
    					<!--{/if}-->
    				</div>
                </div>
				<div class="area">
					<div style="float: left;width:75%;"><textarea name="$editor[textarea]" id="{$editorid}_textarea" class="pt" tabindex="2" rows="15">$editor[value]</textarea></div>
                    <div id="upload_newimage_tools" style="float: right;width: 228px;border-left: 1px solid #EBEBEB;background: #F6F6F6;height:400px;">
                        <h4><span>上传图片</span><span>使用相册</span><!--<span>网络图片</span>--></h4>
                            <div class="p_opt" unselectable="on" id="{$editorid}_multi" style="display: none;">
                				<div class="fswf" id="{$editorid}_multiimg" style="width: 100%;height:100%;overflow: hidden;margin: 0 auto;border:0px">
                                    <div id="{$editorid}_multiimg_swf" style="width: 100%;height: 30px;text-align: left;background: #FFF;">
                                        <div style="background:url('../../static/image/common/upload_img_new.jpg') no-repeat;;font-size:20px;color:#FFF;text-align: center;font-weight:bold;overflow: hidden;cursor:pointer;width:208px;height:30px;"></div>
                                    </div>
                                    <script type="text/javascript" src="static/js/swfobject.js"></script>
                                    <script type="text/javascript">
									var params = {site:"{$_G[siteroot]}misc.php%3fmod=swfupload%26type=image%26fid=$_G[fid]%26random=<!--{echo random(4)}-->"};
									swfobject.embedSWF("static/image/common/newupload.swf", "{$editorid}_multiimg_swf", "208", "52", "11.1.0", "playerProductInstall.swf", params, {wmode:"transparent"});
									swfobject.createCSS("#{$editorid}_multiimg_swf", "display:block;text-align:left;");
                                    </script>
									<div><p style="margin-top:1px;display:none;" id="uploadtips"></p></div>
                                    <div id="{$editorid}_imgattachlist" style='background:#fff;width: 208px;border:1px soild #ccc;'>
                                        <div class="upfilelist">
                                            <div style="background:url('../../static/image/common/list_img_new.jpg') no-repeat;font-size:20px;color:#FFF;text-align: center;font-weight:bold;overflow: hidden;cursor:pointer;height:30px;width:208px"></div>
                                            <div id="photolist_upload" style="overflow: scroll;overFlow-x: hidden;width:208px;padding-top:10px;">
                                                <!--{if !empty($imgattachs['used'])}--><!--{eval $imagelist = $imgattachs['used'];}-->
                        					       <!--{template forum/ajax_imagelist_newimage}-->
                        				        <!--{/if}-->
                                                <div id="imgattachlist" style="width: 200px;">
                                                <!--{if empty($imgattachs['used']) && empty($imgattachs['unused'])}-->
                                                	<p class="notice">{lang no_attachimg}<!--{if $allowuploadnum}-->, 请先{lang attachment_new}<!--{/if}--></p>
                                                <!--{/if}-->
                                                </div>
                                                <div id="unusedimgattachlist"  style="width: 200px;">
                                                <!--{if !empty($imgattachs['unused'])}-->
                                                	<!--{eval $imagelist = $imgattachs['unused'];}-->
                                                	<!--{template forum/ajax_imagelist_newimage}-->
                                                <!--{/if}-->
                                                </div>
                                            </div>
                                        </div>
                                        <div style="height:40px;background: #FFF;padding-top:5px;">
                                        <div style="color:#F26C4F;height:20px;font-weight: bold;">{lang e_img_insertphoto}</div>
                                        <div style="background: #FFF;height:20px"><span id="save_to_album" style="font-weight:bolder;color:#336699;cursor: pointer;">保存到相册</span><span id="insert_all_imagelist" style="font-size: 12px;height:20px;position:relative;font-weight: bold;cursor: pointer;background: #FFF;margin-left:10px;">全部添加</span></div>
                                        <div id="album_contrl" style="position: relative;border: 5px solid #CCC;top:-130px;z-index:999;padding:5px;background:#FFF;display: none;">
                                        <!--{if $_G['group']['allowupload']}-->
                                        <input type="checkbox" id='all_insert_alb' value='insertall'/>{lang save_selected_pic}:<div onclick="this.parentNode.style.display='none'" style="float:right;background:url('../../static/image/common/op.png') no-repeat scroll 0 -2px transparent;height:20px;width:20px;cursor: pointer;"></div>
                                        <select name="uploadalbum" onclick="if(!this.value) {$('newalbum').style.display = ''} else {$('newalbum').style.display = 'none'}">
                                        	<!--{loop $albumlist $album}-->
                                        		<option value="$album[albumid]">$album[albumname]</option>
                                        	<!--{/loop}-->
                                        	<option value="">+{lang create_new_album}</option>
                                        </select>
                                        <input type="text" name="newalbum" id="newalbum" class="px mtn" size="20" value="" style="display:none" />
                                        <!--{/if}-->
                                        </div>
                                        </div>
                                    </div>
                				</div>
                			</div>
                            <div class="p_opt" unselectable="on" id="{$editorid}_albumlist" style="display: none;">
                        		<div class="upfilelist">
                        			{lang uch_selectfromalbum}:
                        			<select onchange="if(this.value) {ajaxget('forum.php?mod=post&new_image_template=1&action=albumphoto&aid='+this.value, 'albumphoto');}">
                        				<option value="">{lang select_album}</option>
                        				<!--{loop $albumlist $album}-->
                        					<option value="$album[albumid]">$album[albumname]</option>
                        				<!--{/loop}-->
                        			</select>
                        			<div id="albumphoto"></div>
                        		</div>
                        		<p class="notice xi1 xw1">{lang e_img_insertphoto}</p>
                        	</div>
                            <div class="p_opt popupfix" unselectable="on" id="{$editorid}_www" style="display: none;">
                                <table cellpadding="0" cellspacing="0" width="100%">
		                            <tr>
                            			<th width="74%">{lang e_img_inserturl}</th>
                            			<th width="13%">{lang e_img_width}</th>
                            			<th width="13%">{lang e_img_height}</th>
                            		</tr>
                            		<tr>
                            			<td><input type="text" id="{$editorid}_image_param_1" onchange="loadimgsize(this.value)" style="width: 95%;" value="" class="px" autocomplete="off" /></td>
                            			<td><input id="{$editorid}_image_param_2" size="1" value="" class="px p_fre" autocomplete="off" /></td>
                            			<td><input id="{$editorid}_image_param_3" size="1" value="" class="px p_fre" autocomplete="off" /></td>
                            		</tr>
		                            <tr>
                            			<td colspan="3" class="pns mtn">
                            				<button type="button" class="pn pnc" id="{$editorid}_image_submit"><strong>{lang submit}</strong></button>
                            				<button type="button" class="pn" onclick="hideMenu();"><em>{lang cancel}</em></button>
                            			</td>
                            		</tr>
                                </table>
                            </div>
                    </div>
                    <div style="clear: both;"></div>
				</div>
				<!--{subtemplate common/editor}-->
			</div>

			<!--{hook/post_middle}-->

			<!--{if $_G['group']['maxprice'] && ($_G[gp_action] == 'newthread' || $_G[gp_action] == 'edit' && $isfirstpost)}-->
				<div class="mtm">
					<!--{if $_G['setting']['maxincperthread']}--><img src="{IMGDIR}/arrow_right.gif" />{lang post_price_income_comment}<!--{/if}-->
					<!--{if $_G['setting']['maxchargespan']}--><img src="{IMGDIR}/arrow_right.gif" />{lang post_price_charge_comment}<!--{if $_G[gp_action] == 'edit' && $freechargehours}-->{lang post_price_free_chargehours}<!--{/if}--><!--{/if}-->
				</div>
			<!--{/if}-->

			<!--{if $_G[gp_action] != 'edit' && checkperm('seccode') && ($secqaacheck || $seccodecheck)}-->
				<!--{block sectpl}--><sec> <span id="sec<hash>" onclick="showMenu(this.id);"><sec></span><div id="sec<hash>_menu" class="p_pop p_opt" style="display:none"><sec></div><!--{/block}-->
				<div class="mtm"><!--{template common/seccheck}--></div>
			<!--{/if}-->

			<!--{if $_G[gp_action] == 'newthread' && $savethreads}-->
				<div class="bm bmn mtm">
					<div class="mbn pbn bbda">
						<a href="home.php?mod=space&uid=$_G['uid']&do=thread&view=me&type=thread&from=&filter=save" class="y xi2">{lang post_message3} &rsaquo;</a>
						<h2>{lang post_message4}<span class="xi1"> $savethreadcount </span>{lang post_message5} <span class="xw0">{lang post_message6}<em class="qsv">&nbsp;</em>{lang post_message7}</span></h2>
					</div>
					<ul>
					<!--{loop $savethreads $savethread}-->
						<li class="mtn"><em class="qsv" title="{lang reply_quote}" onclick="insertsave($savethread[pid])">&nbsp;</em> <a href="forum.php?mod=post&action=edit&fid=$savethread[fid]&tid=$savethread[tid]&pid=$savethread[pid]" class="xi2" target="_blank">$savethread[subject]</a> <span class="xg1">$savethread[dateline]</span></li>
					<!--{/loop}-->
					</ul>
				</div>
			<!--{/if}-->

			<!--{if $_G[gp_action] == 'newthread' && $savethreadothers}-->
				<div class="bm bmn mtm">
					<div class="mbn pbn bbda">
						<a href="home.php?mod=space&uid=$_G['uid']&do=thread&view=me&type=thread&from=&filter=save" class="y xi2">{lang post_message3} &rsaquo;</a>
						<h2>{lang post_message4}<span class="xi1"> $savethreadothercount </span>{lang post_message5} <span class="xw0">{lang post_message6}<em class="qsv">&nbsp;</em>{lang post_message7}</span></h2>
					</div>
					<ul>
						<!--{loop $savethreadothers $savethread}-->
						<li class="mtn"><em class="qsv" title="{lang reply_quote}" onclick="insertsave($savethread[pid])">&nbsp;</em> <a href="forum.php?mod=post&action=edit&fid=$savethread[fid]&tid=$savethread[tid]&pid=$savethread[pid]" class="xi2" target="_blank">$savethread[subject]</a> <span class="xg1">$savethread[dateline]</span></li>
						<!--{/loop}-->
					</ul>
				</div>
			<!--{/if}-->

			<!--{if !empty($_G['setting']['pluginhooks']['post_sync_method'])}-->
				<span>
					{lang post_sync_method}:
					<!--{hook/post_sync_method}-->
				</span>
			<!--{/if}-->

		</div>
	</div>


<div id="{$editorid}_menus" class="editorrow" style="overflow: hidden; margin-top: -5px; height: 0; border: none; background: transparent;">
	<!--{subtemplate common/editor_menu}-->

<div class="p_pof" id="{$editorid}_image_menu" style="display: none;visibility: hidden;" unselectable="on">
	<iframe name="attachframe" id="attachframe" style="display: none;" onload="uploadNextAttach();"></iframe>
</div>
<!--{if $_G['group']['allowpostattach']}-->
	<div class="p_pof upf" id="{$editorid}_attach_menu" style="display: none" unselectable="on">
		<span class="y"><a href="javascript:;" class="flbc" onclick="hideMenu()">{lang close}</a></span>
		<ul class="imguptype" id="{$editorid}_attach_ctrl">
			<li><a href="javascript:;" hidefocus="true" class="current" id="{$editorid}_btn_attachlist" onclick="switchAttachbutton('attachlist');">{lang attachment_list}</a></li>
			<!--{if $_G['setting']['swfupload'] != 1 && $allowuploadnum}--><li><a href="javascript:;" hidefocus="true" id="{$editorid}_btn_upload" onclick="switchAttachbutton('upload');">{lang common_upload}</a></li><!--{/if}-->
			<!--{if $_G['setting']['swfupload'] != 0 && $allowuploadnum}--><li><a href="javascript:;" hidefocus="true" id="{$editorid}_btn_swfupload" onclick="switchAttachbutton('swfupload');">{lang batch_upload}</a></li><!--{/if}-->
		</ul>

		<div class="p_opt post_tablelist" unselectable="on" id="{$editorid}_attachlist">
			<table cellpadding="0" cellspacing="0" border="0" width="100%" id="attach_tblheader"{if empty($attachs['used']) && empty($attachs['unused'])} style="display: none"{/if}>
				<tr>
					<td class="atnu"></td>
					<td class="atna">{lang filename}</td>
					<td class="atds">{lang description}</td>
					<!--{if $_G['group']['allowsetattachperm']}-->
					<td class="attv">
						{lang readperm}
						<img src="http://static.8264.com/static/image/common/faq.gif" alt="Tip" class="vm" style="margin: 0;" onmouseover="showTip(this)" tip="{lang post_select_usergroup_readacces}" />
					</td>
					<!--{/if}-->
					<!--{if $_G['group']['maxprice']}--><td class="attp">{$_G['setting']['extcredits'][$_G['setting']['creditstransextra'][1]][title]}</td><!--{/if}-->
					<td class="attc"></td>
				</tr>
			</table>
			<div class="upfl">
				<!--{if !empty($attachs['used'])}--><!--{eval $attachlist = $attachs['used'];}-->
					<!--{template forum/ajax_attachlist}-->
				<!--{/if}-->
				<div id="attachlist">
					<!--{if empty($attachs['used']) && empty($attachs['unused'])}-->
						<p class="notice">{lang no_attach}<!--{if $allowuploadnum}-->, <a href="javascript:;" onclick="switchAttachbutton('{if $_G['setting']['swfupload'] != 0}swfupload{else}upload{/if}');">{lang click_here}</a>{lang attachment_new}<!--{/if}--></p>
					<!--{/if}-->
				</div>
				<div id="unusedattachlist">
					<!--{if !empty($attachs['unused'])}-->
						<!--{eval $attachlist = $attachs['unused'];}-->
						<table cellpadding="0" cellspacing="0" width="100%"><tr><td class="attachnum"></td><td>{lang attachment_uploaded}</td></tr></table>
						<!--{template forum/ajax_attachlist}-->
					<!--{/if}-->
				</div>
			</div>
			<p class="ptm" id="attach_notice"{if empty($attachs['used']) && empty($attachs['unused'])} style="display: none"{/if}>{lang e_attach_insert}<!--{if $_G['setting']['allowattachurl']}-->{lang e_attach_inserturl}<!--{/if}--></p>
			<!--{if $_G['group']['maxprice'] && $_G['setting']['maxincperthread']}--><p class="notice">{lang post_price_attachincome_comment}</p><!--{/if}-->
		</div>
	</div>
<!--{/if}-->

<script type="text/javascript">
	if(wysiwyg) {
		newEditor(1, bbcode2html(textobj.value));
	} else {
		newEditor(0, textobj.value);
	}

	var ATTACHNUM = {'imageused':0,'imageunused':0,'attachused':0,'attachunused':0};
	function switchImagebutton(btn) {
		var btns = ['www'<!--{if $allowpostimg}-->, 'imgattachlist'<!--{/if}-->, 'albumlist'];
		<!--{if $allowpostimg}-->
			<!--{if $_G['setting']['swfupload'] != 1}-->btns.push('local');<!--{/if}-->
			<!--{if $_G['setting']['swfupload'] != 0}-->btns.push('multi');<!--{/if}-->
		<!--{/if}-->
		switchButton(btn, btns);
		$(editorid + '_image_menu').style.height = '';
	}
	<!--{if $allowpostimg}-->
		ATTACHNUM['imageused'] = <!--{echo @count($imgattachs['used'])}-->;
		ATTACHNUM['imageunused'] = <!--{echo @count($imgattachs['unused'])}-->;
		<!--{if !empty($imgattachs['used']) || !empty($imgattachs['unused'])}-->
			switchImagebutton('imgattachlist');
			$(editorid + '_image').evt = false;
			updateattachnum('image');
		<!--{else}-->
			switchImagebutton('<!--{if $_G['setting']['swfupload'] != 0}-->multi<!--{else}-->local<!--{/if}-->');
		<!--{/if}-->
	<!--{/if}-->
	<!--{if $_G['group']['allowpostattach'] || $_G['group']['allowpostimage']}-->
		function switchAttachbutton(btn) {
			var btns = ['attachlist'];
			<!--{if $_G['setting']['swfupload'] != 1}-->btns.push('upload');<!--{/if}-->
			<!--{if $_G['setting']['swfupload'] != 0}-->btns.push('swfupload');<!--{/if}-->
			switchButton(btn, btns);
		}
		ATTACHNUM['attachused'] = <!--{echo @count($attachs['used'])}-->;
		ATTACHNUM['attachunused'] = <!--{echo @count($attachs['unused'])}-->;
		<!--{if !empty($attachs['used']) || !empty($attachs['unused'])}-->
			$(editorid + '_attach').evt = false;
			updateattachnum('attach');
		<!--{else}-->
			switchAttachbutton('<!--{if $_G['setting']['swfupload'] != 0}-->swfupload<!--{else}-->upload<!--{/if}-->');
		<!--{/if}-->
	<!--{/if}-->
	<!--{if !empty($attachs['unused']) || !empty($imgattachs['unused'])}-->
		var msg = '<form id="unusedform"><div class="c ufl" style="{if count($attachs[unused]) + count($imgattachs[unused]) > 10}height:180px;{/if}overflow-y:auto;overflow-x:hidden"><p class="xg2">{lang attachment_uploaded}</p>'
		<!--{loop $attachs['unused'] $attach}-->
			+ '<p id="unusedrow$attach[aid]"><a href="javascript:;" class="d" title="{lang ignore}" onclick="unusedoption(2, $attach[aid])">{lang ignore}</a><a href="javascript:;" class="d deletepic" title="{lang delete}" attachid="$attach[aid]">{lang delete}</a><label><input id="unused$attach[aid]" name="unused[]" value="$attach[aid]" checked type="checkbox" class="pc" /> <span title="$attach[filenametitle] $attach[dateline]">$attach[filename]</span></label></p>'
		<!--{/loop}-->
		<!--{loop $imgattachs['unused'] $attach}-->
			+ '<p id="unusedrow$attach[aid]"><a href="javascript:;" class="d" title="{lang ignore}" onclick="unusedoption(3, $attach[aid])">{lang ignore}</a><a href="javascript:;" class="d deletepic" title="{lang delete}" attachid="$attach[aid]">{lang delete}</a><label><input id="unused$attach[aid]" name="unused[]" value="$attach[aid]" checked type="checkbox" class="pc" /> <span title="$attach[filenametitle] $attach[dateline]">$attach[filename]</span></label></p>'
		<!--{/loop}-->
		+ '</div><div class="o pns cl"><label class="z"><input type="checkbox" name="chkall" class="pc" checked="checked" onclick="checkall(this.form, \'unused\', \'chkall\')" /> {lang checkall}</label><button type="button" value="true" class="pn" onclick="unusedoption(0)"><span>{lang ignore}</span></button> <button type="button" value="true" class="pn deletepic"><span>{lang delete}</span></button> <button type="button" value="true" class="pn pnc" onclick="unusedoption(1)"><span>{lang use}</span></button> </div></form>';
		showDialog(msg, 'info', '', '', 1);
	<!--{/if}-->
	setCaretAtEnd();
	if(BROWSER.ie >= 5 || BROWSER.firefox >= '2') {
		_attachEvent(window, 'beforeunload', saveData);
	}
	<!--{if !empty($_G['gp_cedit']) && $_G['gp_cedit'] == 'yes'}-->
		loadData(1);
		$(editorid + '_switchercheck').checked = !wysiwyg;
	<!--{/if}-->
</script>
<style>
.c a.deletepic{background-position: 0 -42px;}
.c a.deletepic:hover{background-position: 0 -62px;}
</style>
</div>

<script type="text/javascript">
	var editorsubmit = $('postsubmit');
	var editorform = $('postform');
	var allowpostattach = parseInt('{$_G['group']['allowpostattach']}');
	var allowpostimg = parseInt('$allowpostimg');
	var pid = parseInt('$pid');
	var extensions = '{eval echo str_replace(array('jpeg,','gif,','jpg,','png,') ,'' ,$_G['group']['attachextensions'])}';
	var imgexts = '$imgexts';
	var postminchars = parseInt('$_G['setting']['minpostsize']');
	var postmaxchars = parseInt('$_G['setting']['maxpostsize']');
	var disablepostctrl = parseInt('{$_G['group']['disablepostctrl']}');
	var seccodecheck = parseInt('<!--{if checkperm('seccode') && $seccodecheck}-->1<!--{else}-->0<!--{/if}-->');
	var secqaacheck = parseInt('<!--{if checkperm('seccode') && $secqaacheck}-->1<!--{else}-->0<!--{/if}-->');
	var typerequired = parseInt('{$_G[forum][threadtypes][required]}');
	var sortrequired = parseInt('{$_G[forum][threadsorts][required]}');
	var special = parseInt('$special');
	var isfirstpost = <!--{if $isfirstpost}-->1<!--{else}-->0<!--{/if}-->;
	var allowposttrade = parseInt('{$_G['group']['allowposttrade']}');
	var allowpostreward = parseInt('{$_G['group']['allowpostreward']}');
	var allowpostactivity = parseInt('{$_G['group']['allowpostactivity']}');
	var sortid = parseInt('$sortid');
	var special = parseInt('$special');
	var fid = {$fid};

	<!--{if $isfirstpost && !empty($_G[forum][threadtypes][types])}-->
		simulateSelect('typeid');
	<!--{/if}-->
	<!--{if !$isfirstpost && $thread['special'] == 5 && empty($firststand) && $_G[gp_action] != 'edit'}-->
		simulateSelect('stand');
	<!--{/if}-->
	<!--{if !$special && $_G[forum][threadsorts] && ($_G[gp_action] == 'newthread' || $_G[gp_action] == 'edit' && $isfirstpost && !$thread[sortid])}-->
		simulateSelect('sortid');
		function switchsort() {
			if($('sortid').value) {
				saveData(1);
				<!--{if $isfirstpost && $sortid}-->
					ajaxget('forum.php?mod=post&action=threadsorts&sortid=' + $('sortid').value + '&fid=$_G[fid]<!--{if !empty($modelid)}-->&modelid=$modelid<!--{/if}--><!--{if !empty($_G[gp_modthreadkey])}-->&modthreadkey=$_G[gp_modthreadkey]<!--{/if}-->', 'threadsorts', 'threadsortswait', null, null, function () { seteditorcontrolpos(); });
				<!--{else}-->
					location.href = 'forum.php?mod=post&action=$_G[gp_action]&fid=$_G[fid]<!--{if !empty($_G[tid])}-->&tid=$_G[tid]<!--{/if}--><!--{if !empty($pid)}-->&pid=$pid<!--{/if}--><!--{if !empty($modelid)}-->&modelid=$modelid<!--{/if}-->&extra=$extra<!--{if !$sortid}-->&cedit=yes<!--{/if}-->&sortid=' + $('sortid').value;
				<!--{/if}-->
				Editorwin = 0;
			}
		}
	<!--{/if}-->
	<!--{if $isfirstpost}-->
		<!--{if $sortid}-->
			ajaxget('forum.php?mod=post&action=threadsorts&sortid=$sortid&fid=$_G[fid]<!--{if !empty($_G[tid])}-->&tid=$_G[tid]<!--{/if}-->&inajax=1<!--{if !empty($_G[gp_modthreadkey])}-->&modthreadkey=$_G[gp_modthreadkey]<!--{/if}-->', 'threadsorts', 'threadsortswait', null, null, function () { seteditorcontrolpos(); });
		<!--{elseif $_G['forum']['threadsorts']['required'] && !$special}-->
			<!--{eval $threadsortids = array_keys($threadsorts[types]);}-->
			ajaxget('forum.php?mod=post&action=threadsorts&sortid={$threadsortids[0]}&fid=$_G[fid]<!--{if !empty($_G[tid])}-->&tid=$_G[tid]<!--{/if}-->&inajax=1<!--{if !empty($_G[gp_modthreadkey])}-->&modthreadkey=$_G[gp_modthreadkey]<!--{/if}-->', 'threadsorts', 'threadsortswait', null, null, function () { seteditorcontrolpos(); });
		<!--{/if}-->
	<!--{/if}-->

	<!--{if $_G[gp_action] == 'newthread' && $_G['setting']['sitemessage'][newthread] || $_G[gp_action] == 'reply' && $_G['setting']['sitemessage'][reply]}-->
		showPrompt('custominfo', 'mouseover', '<!--{if $_G[gp_action] == 'newthread'}--><!--{echo trim($_G['setting']['sitemessage'][newthread][array_rand($_G['setting']['sitemessage'][newthread])])}--><!--{elseif $_G[gp_action] == 'reply'}--><!--{echo trim($_G['setting']['sitemessage'][reply][array_rand($_G['setting']['sitemessage'][reply])])}--><!--{/if}-->', $_G['setting']['sitemessage'][time]);
	<!--{/if}-->
	<!--{if $_G['setting']['swfupload'] != 1 && $_G['group']['allowpostattach']}-->addAttach();<!--{/if}-->
	<!--{if $_G['setting']['swfupload'] != 1 && $allowpostimg}-->addAttach('img');<!--{/if}-->

	if($('subjectbox')) {
		var tmp_obj = $('e_textarea');
		if(tmp_obj && tmp_obj.style.display == '') {
			tmp_obj.focus();
		}
	} else if($('subject')) {
		$('subject').focus();
	}
	function uploadsuccess(num,type) {
		ajaxget('forum.php?mod=ajax&action=imagelist&new_template=1', 'imgattachlist');
	}
</script>
<script type="text/javascript">
;(function($){
    $("#psd").hide().css('top','215px').show();
    $("#fujia_tools").click(function(){
        if($("#fujia_tools span").html()=='-'){
            $("#fujia_tools span").html('+');
            $("#fujia_tools").attr('title','点击显示');
            $("#fujia_tools").next().hide();
            $("#fujia_tools").removeClass('bbs pbm mbm');
            $("#ct .mn").css('width',$("#wp").width());
            $("#{$editorid}_iframe").parent().width($("#{$editorid}_iframe").parent().parent().width()-$("#upload_newimage_tools").width()-10);
        }else{
            $("#fujia_tools span").html('-');
            $("#fujia_tools").attr('title','点击隐藏');
            $("#fujia_tools").next().show();
            $("#fujia_tools").addClass('bbs pbm mbm');
            $("#ct .mn").css('width',$("#wp").width()-150);
            $("#{$editorid}_iframe").parent().width($("#{$editorid}_iframe").parent().parent().width()-$("#upload_newimage_tools").width()-10);
        }
    });
    $("#nv_forum").one('mouseover',function(){
        if($("#fujia_tools span").html()=='-'){
            $("#ct .mn").css('width',$("#wp").width()-150);
        }else{
            $("#ct .mn").css('width',$("#wp").width());
        }
        if($("#wp").width()>960){
			$("#stip").css('right','295px');
            $("#psd").css('right','165px');
			if($("#tpflreturn")!=null){$("#tpflreturn").css('right','205px');}
        }else{
			$("#stip").css('right','460px');
            $("#psd").css('right','230px');
			if($("#tpflreturn")!=null){$("#tpflreturn").css('right','375px');}
        }
        $("#{$editorid}_iframe").parent().width($("#{$editorid}_iframe").parent().parent().width()-$("#upload_newimage_tools").width()-10);
    });
    $(document).on('click mouseleave',"#wh",function(){
        if($("#fujia_tools span").html()=='-'){
            $("#ct .mn").css('width',$("#wp").width()-150);
        }else{
            $("#ct .mn").css('width',$("#wp").width());
        }
        if($("#wp").width()>960){
			$("#stip").css('right','295px');
            $("#psd").css('right','165px');
			if($("#tpflreturn")!=null){$("#tpflreturn").css('right','205px');}
        }else{
			$("#stip").css('right','460px');
            $("#psd").css('right','230px');
			if($("#tpflreturn")!=null){$("#tpflreturn").css('right','375px');}
        }
        $("#wp").one('mouseenter',function(){
            if($("#fujia_tools span").html()=='-'){
                $("#ct .mn").css('width',$("#wp").width()-150);
            }else{
                $("#ct .mn").css('width',$("#wp").width());
            }
            if($("#wp").width()>960){
				$("#stip").css('right','295px');
                $("#psd").css('right','165px');
				if($("#tpflreturn")!=null){$("#tpflreturn").css('right','205px');}
            }else{
				$("#stip").css('right','460px');
                $("#psd").css('right','230px');
				if($("#tpflreturn")!=null){$("#tpflreturn").css('right','375px');}
            }
        });
        $("#{$editorid}_iframe").parent().width($("#{$editorid}_iframe").parent().parent().width()-$("#upload_newimage_tools").width()-10);
        change__multi_height();
    });

    $("#stip").click(function(){
	$(this).hide();
    });
    $("#{$editorid}_image").click(function(){
        if($("#upload_newimage_tools").css('display')=='none'){
            $("#upload_newimage_tools").show();
            $("#{$editorid}_iframe").parent().width('75%');
        }else{
            $("#upload_newimage_tools").hide();
            $("#{$editorid}_iframe").width('99%');
            $("#{$editorid}_iframe").parent().width('99%');
        }
    });
    $("#upload_newimage_tools h4 span").click(function(){
        $(this).css({'border-color':'#CCC','border-bottom-color':'#F2F2F2','background':'#F2F2F2'}).siblings().css({'border-color':'#FFF','border-bottom-color':'#CCC','background':'#FFF'}).end().parent().css({'border-bottom-color':'#CCC'}).end();
        var select_mod=$(this).index();
        switch(select_mod){
            case 0:
            var displaymod='multi';
            break;
            case 1:
            var displaymod='albumlist';
            break;
            default:
            return false;
            break;
        }
        $('#{$editorid}_'+displaymod).show().siblings(':not(h4)').hide();
    });
    function change__multi_height(){
        var zong_height=$("#upload_newimage_tools").height();
        var h4_height=$("#upload_newimage_tools :first").outerHeight();
        var multi_height=zong_height-h4_height-20;
        $("#{$editorid}_multi").height(multi_height);
        $("#{$editorid}_imgattachlist").height($("#{$editorid}_multiimg").height()-$("#{$editorid}_multiimg_swf").height());
        var imgattachlist_height=$("#{$editorid}_imgattachlist").height();
        $("#{$editorid}_imgattachlist :first").height(imgattachlist_height-45-5);
        var upfiles_height=$("#{$editorid}_imgattachlist :first").height();
        $("#photolist_upload").height(upfiles_height-30-5);
    }
    $(document).on('mouseleave','#photolist_upload tr td',function(){
        $(this).children('.delimg_icon').css('visibility','hidden');
    });
    $(document).on('mouseover','#photolist_upload tr td',function(){
        $(this).children('.delimg_icon').css('visibility','visible');
    });
    $(document).on('mouseenter','#upload_newimage_tools img',function(){
        $('#img_display_view').remove();
        var img_src=$(this).attr('src');
        if($(this).parents('#albumphoto').attr('id')=='albumphoto' && img_src.indexOf('.thumb.')>=0){
            img_src=img_src.substr(0,(img_src.length-10));
        }
        var off_left=$("#upload_newimage_tools").offset().left-330;
        var off_top=$("#upload_newimage_tools").offset().top+50;
        $("#{$editorid}_body").append("<div id='img_display_view' style='float:right;display:none;border:5px solid #BBB;padding:10px;background:#FFF;position:absolute;top:"+off_top+"px;left:"+off_left+"px;width:150px;height:30px;z-index:999'><div id='tips_loading' style='font-weight:bold;position:inherit;z-index:101;width:150px;height:30px;font-size:16px;line-height:30px;text-align:center;'>正在载入...</div><img src='"+img_src+"' onload=document.getElementById('tips_loading').style.display='none'; style='display:none;float:left;max-width:300px;max-height:300px;position:inherit'/><div>");
        $("#img_display_view img").error(function(){
            var top_error=$("#{$editorid}_body").offset().top+300;
            $(this).prev().text('载入失败').parent().css({'left':'508px','top':top_error}).end().end().remove();
            var parent_width=$('#tips_loading').width();
            var parent_height=$('#tips_loading').height();
            $('#img_display_view').width(parent_width).height(parent_height).fadeIn(500);
        });
        $('#img_display_view img').load(function(){
            var img_width=$('#img_display_view').offset().left+(300-$(this).width());
            $(this).prev().remove().end().parent().css({'left':img_width});
            var parent_width=$(this).width();
            var parent_height=$(this).height();
            $(this).show();
            $('#img_display_view').width(parent_width).height(parent_height).fadeIn(500);
        });
        $("#img_display_view").fadeIn(500);
    });
    $(document).on('mouseleave','#upload_newimage_tools img',function(){
        $('#img_display_view').remove();
    });
    if(/webkit/.test(navigator.userAgent.toLowerCase()) || /opera/.test(navigator.userAgent.toLowerCase())){
        $(document).on('click',"#{$editorid}_multiimg_swf",function(){
            //$(this).height('150px');
            $("#{$editorid}_multiimg_swf :first").slideUp(300).siblings().show();
            change__multi_height();
        });
        $(document).on('mouseenter',"#{$editorid}_multiimg_swf",function(){
            dis_tips();
            $("#tips_limit").show();
        });
        $(document).on('click',"#{$editorid}_imgattachlist",function(){
            $("#{$editorid}_multiimg_swf").height('52px');
            $("#{$editorid}_multiimg_swf :first").slideDown(300).siblings().hide();
            change__multi_height();
            dis_tips();
            $("#tips_limit").hide();
        });
        $(document).on('mousemove',"#upload_newimage_tools",function(){
            change__multi_height();
        })
    }else{
        $(document).on('mouseenter',"#{$editorid}_multiimg_swf",function(){
            //$(this).height('150px');
            change__multi_height();
            $("#{$editorid}_multiimg_swf :first").slideUp(300).siblings().show();
            dis_tips();
            $("#tips_limit").show();
        });
        $(document).on('mouseenter',"#{$editorid}_imgattachlist",function(){
            $("#{$editorid}_multiimg_swf").height('52px');
            change__multi_height();
            $("#{$editorid}_multiimg_swf :first").slideDown(300).siblings().hide();
        });
    }
    $(document).on('mouseleave',"#{$editorid}_multiimg_swf",function(){
        dis_tips();
        $("#tips_limit").hide();
    });
    function dis_tips(){
        var tips_left=$("#{$editorid}_multiimg_swf").offset().left-$("#tips_limit").width()-20;
        var tips_top=$("#{$editorid}_multiimg_swf").offset().top+20;
        $("#tips_limit").css({"left":tips_left,"top":tips_top});
    }
    $(document).on('click',"#insert_all_imagelist",function(){
        var have_img_len=$("#{$editorid}_iframe").contents().find('body img').length;
        var len_img=$('.imgl td:not(.imgdeleted) img').length;
        if(len_img>3){
            showDialog('你列表中的文件超过三张，超过三张的图片将会保存在列表内，您可以再次发帖时使用！');
        }
        for(i=0;i<(3-have_img_len);i++){
            $('.imgl td:not(.imgdeleted) img:eq('+i+')').click();
            if(have_img_len>0){
                //$("#{$editorid}_iframe").contents().find('body img:last').before('<br/>');
            }else{
                if(i>=1){
                    //$("#{$editorid}_iframe").contents().find('body img:last').before('<br/>');
                }
            }
        }
    });
    $(document).on('click',"#all_insert_alb",function(){
        $("#photolist_upload input:checkbox").click();
        if($("#photolist_upload input:hidden.pc").val()=="" && $("#all_insert_alb").attr('checked')=='checked'){
            $("#photolist_upload input:checkbox").click();
        }
    });
    $(document).on('mouseenter',"#{$editorid}_fullswitcher",function(){
        $("#e_iframe").parent().width("75%");
        $(".area").one('mouseover mousemove',function(){
            change__multi_height();
        });
    });
    $("#save_to_album").click(function(){
        $("#album_contrl").toggle();
    });
    function img_width_fix(){
        $("#{$editorid}_iframe").contents().find('body').children('img').load(function(){
            $(this).removeAttr('width');
        });
    }
    img_width_fix();
    if(/msie/.test(navigator.userAgent.toLowerCase())){
        $("#{$editorid}_iframe").one("mousemove",function(){
            img_width_fix();
        });
    }
    $("#{$editorid}_multiimg_swf :eq(1)").hide();
    $("#upload_newimage_tools h4 span:first").click();
    $('#fujia_tools').click();
    $("#{$editorid}_multiimg_swf").click();
    change__multi_height();
	$('#unusedform>.o.pns.cl>button.deletepic').click(function(event){
		$('#unusedform>div>p').find('input[type=checkbox]').each(function(){
			if($(this).is(':checked')){
				$(this).parents('p').find('a.deletepic').click();
			}
		});
  		hideMenu('fwin_dialog', 'dialog');
	});
	$('#unusedform .deletepic').click(function(event){
		var m_attach_id = $(this).attr('attachid');
		if(m_attach_id > 0){
			ajaxget('forum.php?mod=ajax&action=deletepic&picid=' + m_attach_id, "hiddenobj");
			$('#unusedrow' + m_attach_id).remove();
		}
	});
})(jQuery);
</script>
