
<!--{if $_G[gp_action] == 'edit'}--><!--{eval $editor[value] = $postinfo[message];}--><!--{else}--><!--{eval $editor[value] = $message;}--><!--{/if}-->
<script type="text/javascript" src="{$_G['setting']['jspath']}forum_post.js?{VERHASH}"></script>
<!--{eval $adveditor = $isfirstpost && $special || $special == 2 && ($_G['gp_action'] == 'newthread' || $_G['gp_action'] == 'reply' && !empty($_G['gp_addtrade']) || $_G['gp_action'] == 'edit' && $thread['special'] == 2);}-->
<!--{eval $advmore = !$showthreadsorts && !$special || $_G['gp_action'] == 'reply' && empty($_G['gp_addtrade']) || $_G['gp_action'] == 'edit' && !$isfirstpost && ($thread['special'] == 2 && !$special || $thread['special'] != 2);}-->
			<input type="hidden" name="formhash" id="formhash" value="{FORMHASH}" />
			<input type="hidden" name="posttime" id="posttime" value="{TIMESTAMP}" />
			<input type="hidden" name="wysiwyg" id="{$editorid}_mode" value="$editormode" />		
			<div id="rstnotice" style="display:none"></div>
			<div class="edt" id="{$editorid}_body">
				<div id="{$editorid}_controls" class="bar">
					<div class="y">
						<div class="b2r nbl nbr" id="{$editorid}_adv_5">
							<p>
								<a id="{$editorid}_undo" title="{lang e_undo}">Undo</a>
							</p>
							<p>
								<a id="{$editorid}_redo" title="{lang e_redo}">Redo</a>
							</p>
						</div>
						<div class="z">
							<span class="mbn"><a id="{$editorid}_fullswitcher"></a><a id="{$editorid}_simple"></a></span>
							<label id="{$editorid}_switcher" class="bar_swch ptn"><input id="{$editorid}_switchercheck" type="checkbox" class="pc" name="checkbox" value="0" {if !$editor[editormode]}checked="checked"{/if} onclick="switchEditor(this.checked?0:1)" />{lang code}</label>
						</div>
					</div>
					<!--{if !empty($_G[setting][pluginhooks][post_editorctrl_right])}-->
						<div class="y"><!--{hook/post_editorctrl_right}--></div>
					<!--{/if}-->
					<div id="{$editorid}_button" class="btn cl">
						<div class="b1r" id="{$editorid}_adv_s0">
							<a id="{$editorid}_paste" title="{lang e_paste}">{lang e_paste}</a>
						</div>
						<div class="b2r nbr" id="{$editorid}_adv_s2">
							<a id="{$editorid}_fontname" class="dp" title="{lang e_fontname}"><span id="{$editorid}_font">{lang e_font}</span></a>
							<a id="{$editorid}_fontsize" class="dp" title="{lang e_fontsize}"><span id="{$editorid}_size">{lang e_size}</span></a>
							<br id="{$editorid}_adv_1" />
							<a id="{$editorid}_bold" title="{lang e_bold}">B</a>
							<a id="{$editorid}_italic" title="{lang e_italic}">I</a>
							<a id="{$editorid}_underline" title="{lang e_underline}">U</a>
							<a id="{$editorid}_forecolor" title="{lang e_forecolor}">Color</a>
							<a id="{$editorid}_url" title="{lang e_url}">Url</a>
							<span id="{$editorid}_adv_8">
							<a id="{$editorid}_unlink" title="{lang e_unlink}">Unlink</a>
							<a id="{$editorid}_inserthorizontalrule" title="{lang e_hr_title}">Hr</a>
							</span>
						</div>
						<div class="b2r nbl" id="{$editorid}_adv_2">
							<p id="{$editorid}_adv_3">
								<a id="{$editorid}_tbl" title="{lang e_table}">Table</a>
							</p>
							<p>
								<a id="{$editorid}_removeformat" title="{lang e_removeformat}">Removeformat</a>
							</p>
						</div>
						<div class="b2r">
							<p>
								<a id="{$editorid}_justifyleft" title="{lang e_left}">Left</a>
								<a id="{$editorid}_justifycenter" title="{lang e_center}">Center</a>
								<a id="{$editorid}_justifyright" title="{lang e_right}">Right</a>
							</p>
							<p id="{$editorid}_adv_4">
								<a id="{$editorid}_autotypeset" title="{lang e_autotypeset}">Autotypeset</a>
								<a id="{$editorid}_insertorderedlist" title="{lang e_orderedlist}">Orderedlist</a>
								<a id="{$editorid}_insertunorderedlist" title="{lang e_unorderedlist}">Unorderedlist</a>								
							</p>
						</div>
						<div class="b1r" id="{$editorid}_adv_s1">
							<a id="{$editorid}_sml" title="{lang e_smilies_title}">{lang e_smilies}</a>
							<div id="{$editorid}_imagen" style="display:none">!</div>
							<a id="{$editorid}_image" title="{lang e_image_title}">{lang e_image}</a>
							<!--{if $_G['group']['allowpostattach']}-->
								<div id="{$editorid}_attachn" style="display:none">!</div>
								<a id="{$editorid}_attach" title="{lang e_attach_title}">{lang e_attach}</a>
							<!--{/if}-->
							<!--{if $_G['forum']['allowmediacode']}-->
								<a id="{$editorid}_aud" title="{lang e_audio_title}">{lang e_audio}</a>
								<a id="{$editorid}_vid" title="{lang e_video_title}">{lang e_video}</a>
								
							<!--{/if}-->
							<!--{hook/post_editorctrl_left}-->
						</div>
						<div class="b2r{if $_G['cache']['bbcodes_display'][$_G['groupid']]} nbr{/if}" id="{$editorid}_adv_6">
							<p>
								<a id="{$editorid}_code" title="{lang e_code_title}">{lang e_code}</a>
								<!--{if $isfirstpost && $_G['group']['allowhidecode']}--><a id="{$editorid}_hide" title="{lang e_hide}">Hide</a><!--{/if}-->
							</p>
							<p>
								<a id="{$editorid}_quote" title="{lang e_quote_title}">{lang e_quote}</a>
								<!--{if $isfirstpost}--><a id="{$editorid}_free" title="{lang e_free}">Free</a><!--{/if}-->
							</p>
						</div>
						<!--{if $_G['cache']['bbcodes_display'][$_G['groupid']]}-->
						<div class="b2r nbl">
							<!--{loop $_G['cache']['bbcodes_display'][$_G['groupid']] $tag $bbcode}-->
								<!--{if $bbcode['i'] % 2 != 0}--><a id="{$editorid}_cst{$bbcode[params]}_$tag" class="cst" title="$bbcode[explanation]"><img src="{STATICURL}image/common/$bbcode[icon]" title="$bbcode[explanation]" alt="$tag" /></a><!--{/if}-->
							<!--{/loop}-->
							<!--{hook/post_editorctrl_top}-->
							<br id="{$editorid}_adv_7" />
							<!--{loop $_G['cache']['bbcodes_display'][$_G['groupid']] $tag $bbcode}-->
								<!--{if $bbcode['i'] % 2 == 0}--><a id="{$editorid}_cst{$bbcode[params]}_$tag" class="cst" title="$bbcode[explanation]"><img src="{STATICURL}image/common/$bbcode[icon]" title="$bbcode[explanation]" alt="$tag" /></a><!--{/if}-->
							<!--{/loop}-->
							<!--{hook/post_editorctrl_bottom}-->
						</div>
						<!--{/if}-->
						<!--{if $_G['setting']['magicstatus'] && !empty($_G['setting']['magics']['doodle'])}-->
							<div class="b2r">
								<a id="a_magic_doodle" href="home.php?mod=magic&mid=doodle&showid=comment_doodle&target={$editorid}_textarea&from=forumeditor" class="cst" onclick="showWindow(this.id, this.href, 'get', 0)"><img src="{STATICURL}image/magic/doodle.small.gif" alt="doodle" title="$_G['setting']['magics']['doodle']" style="margin-top:2px" /></a>
							</div>
						<!--{/if}-->
					</div>
				</div>
                <style>
                #upload_newimage_tools h4 span{padding: 0 5px;display: block;float: left;cursor:pointer;font-size:13px;font-weight: bold;border:1px solid #F6F6F6;border-bottom-width:1px;border-bottom-color: #CCC;margin-right:5px;position: relative;top: 1px;font-family: Arial,PMingLiU,sans-serif;}
                #upload_newimage_tools h4{height:30px;line-height: 28px;padding-top:2px;padding-left:5px;border-bottom: 1px solid #CCC;background:#FFF}
                #tips_limit{position: absolute;background:#FFF;border:5px solid #CCC;display: none;}
				#uploadtips{color:blue;text-align:center;}
                </style>
                <div id="tips_limit">
                    <div class="notice upnf">
                        照片可以多个选取，批量上传
    						<br />照片大小：小于8.7MB,边长小于2500像素，否则无法上传。
                        <!--{if $_G['group']['maxattachnum'] || $_G['group']['maxsizeperday']}-->
                        <br />{lang attachment_limit}: <!--{if $_G['group']['maxattachnum']}--><strong>$allowuploadnum</strong> {lang attachment_unit}&nbsp;<!--{/if}--><!--{if $_G['group']['maxsizeperday']}--><strong>$allowuploadsize</strong>&nbsp;<!--{/if}-->
    					<!--{/if}-->
    					<!--{if $imgexts}-->
    						<br />{lang attachment_allow_exts}: <strong>$imgexts</strong>&nbsp;
    					<!--{/if}-->
    					<!--{if $creditstring}-->
    						<br /><a href="forum.php?mod=faq&action=credits&fid=$_G[fid]" target="_blank" title="{lang credits_policy}">{lang post_credits_postattach}&nbsp;$creditstring</a>
    					<!--{/if}-->
    				</div>
                </div>
				<div class="area">
					<div style="float: left;width:75%;"><textarea name="$editor[textarea]" id="{$editorid}_textarea" class="pt" tabindex="2" rows="15">$editor[value]</textarea></div>
                    <div id="upload_newimage_tools" style="float: right;width: 228px;border-left: 1px solid #EBEBEB;background: #F6F6F6;height:400px;">
                        <h4><span>上传图片</span><span>使用相册</span><!--<span>网络图片</span>--></h4>
                            <div class="p_opt" unselectable="on" id="{$editorid}_multi" style="display: none;">
                				<div class="fswf" id="{$editorid}_multiimg" style="width: 100%;height:100%;overflow: hidden;margin: 0 auto;border:0px">
                                    <div id="{$editorid}_multiimg_swf" style="width: 100%;height: 30px;text-align: left;background: #FFF;">
                                        <div style="background:url('../../static/image/common/upload_img_new.jpg') no-repeat;;font-size:20px;color:#FFF;text-align: center;font-weight:bold;overflow: hidden;cursor:pointer;width:208px;height:30px;"></div>
                                    </div>
                                    <script type="text/javascript" src="static/js/swfobject.js"></script>
                                    <script type="text/javascript">
									var params = {site:"{$_G[siteroot]}misc.php%3fmod=swfupload%26type=image%26fid=$_G[fid]%26random=<!--{echo random(4)}-->"};
									swfobject.embedSWF("{IMGDIR}/newupload.swf", "{$editorid}_multiimg_swf", "208", "52", "11.1.0", "playerProductInstall.swf", params, {wmode:"transparent"});
									swfobject.createCSS("#{$editorid}_multiimg_swf", "display:block;text-align:left;");
                                    </script>
									<div><p style="margin-top:1px;display:none;" id="uploadtips"></p></div>
                                    <div id="{$editorid}_imgattachlist" style='background:#fff;width: 208px;border:1px soild #ccc;'>
                                        <div class="upfilelist">
                                            <div style="background:url('../../static/image/common/list_img_new.jpg') no-repeat;font-size:20px;color:#FFF;text-align: center;font-weight:bold;overflow: hidden;cursor:pointer;height:30px;width:208px"></div>
                                            <div id="photolist_upload" style="overflow: scroll;overFlow-x: hidden;width:208px;padding-top:10px;">
                                                <!--{if !empty($imgattachs['used'])}--><!--{eval $imagelist = $imgattachs['used'];}-->
                        					       <!--{template forum/ajax_imagelist_newimage}-->
                        				        <!--{/if}-->
                                                <div id="imgattachlist" style="width: 200px;">
                                                <!--{if empty($imgattachs['used']) && empty($imgattachs['unused'])}-->
                                                	<p class="notice">{lang no_attachimg}<!--{if $allowuploadnum}-->, 请先{lang attachment_new}<!--{/if}--></p>
                                                <!--{/if}-->
                                                </div>
                                                <div id="unusedimgattachlist"  style="width: 200px;">
                                                <!--{if !empty($imgattachs['unused'])}-->
                                                	<!--{eval $imagelist = $imgattachs['unused'];}-->
                                                	<!--{template forum/ajax_imagelist_newimage}-->
                                                <!--{/if}-->
                                                </div>
                                            </div>
                                        </div>
                                        <div style="height:40px;background: #FFF;padding-top:5px;">
                                        <div style="color:#F26C4F;height:20px;font-weight: bold;">{lang e_img_insertphoto}</div>
                                        <div style="background: #FFF;height:20px"><span id="save_to_album" style="font-weight:bolder;color:#336699;cursor: pointer;">保存到相册</span><span id="insert_all_imagelist" style="font-size: 12px;height:20px;position:relative;font-weight: bold;cursor: pointer;background: #FFF;margin-left:10px;">全部添加</span></div>
                                        <div id="album_contrl" style="position: relative;border: 5px solid #CCC;top:-130px;z-index:999;padding:5px;background:#FFF;display: none;">
                                        <!--{if $_G['group']['allowupload']}-->
                                        <input type="checkbox" id='all_insert_alb' value='insertall'/>{lang save_selected_pic}:<div onclick="this.parentNode.style.display='none'" style="float:right;background:url('../../static/image/common/op.png') no-repeat scroll 0 -2px transparent;height:20px;width:20px;cursor: pointer;"></div>
                                        <select name="uploadalbum" onclick="if(!this.value) {$('newalbum').style.display = ''} else {$('newalbum').style.display = 'none'}">
                                        	<!--{loop $albumlist $album}-->
                                        		<option value="$album[albumid]">$album[albumname]</option>
                                        	<!--{/loop}-->
                                        	<option value="">+{lang create_new_album}</option>
                                        </select>
                                        <input type="text" name="newalbum" id="newalbum" class="px mtn" size="20" value="" style="display:none" />
                                        <!--{/if}-->
                                        </div>
                                        </div>
                                    </div>
                				</div>
                			</div>
                            <div class="p_opt" unselectable="on" id="{$editorid}_albumlist" style="display: none;">
                        		<div class="upfilelist">
                        			{lang uch_selectfromalbum}:
                        			<select onchange="if(this.value) {ajaxget('forum.php?mod=post&new_image_template=1&action=albumphoto&aid='+this.value, 'albumphoto');}">
                        				<option value="">{lang select_album}</option>
                        				<!--{loop $albumlist $album}-->
                        					<option value="$album[albumid]">$album[albumname]</option>
                        				<!--{/loop}-->
                        			</select>
                        			<div id="albumphoto"></div>
                        		</div>
                        		<p class="notice xi1 xw1">{lang e_img_insertphoto}</p>
                        	</div>
                            <div class="p_opt popupfix" unselectable="on" id="{$editorid}_www" style="display: none;">
                                <table cellpadding="0" cellspacing="0" width="100%">
		                            <tr>
                            			<th width="74%">{lang e_img_inserturl}</th>
                            			<th width="13%">{lang e_img_width}</th>
                            			<th width="13%">{lang e_img_height}</th>
                            		</tr>
                            		<tr>
                            			<td><input type="text" id="{$editorid}_image_param_1" onchange="loadimgsize(this.value)" style="width: 95%;" value="" class="px" autocomplete="off" /></td>
                            			<td><input id="{$editorid}_image_param_2" size="1" value="" class="px p_fre" autocomplete="off" /></td>
                            			<td><input id="{$editorid}_image_param_3" size="1" value="" class="px p_fre" autocomplete="off" /></td>
                            		</tr>
		                            <tr>
                            			<td colspan="3" class="pns mtn">
                            				<button type="button" class="pn pnc" id="{$editorid}_image_submit"><strong>{lang submit}</strong></button>
                            				<button type="button" class="pn" onclick="hideMenu();"><em>{lang cancel}</em></button>
                            			</td>
                            		</tr>
                                </table>
                            </div>
                    </div>
                    <div style="clear: both;"></div>
				</div>
				<!--{subtemplate common/editor}-->
			</div>

			<!--{hook/post_middle}-->

			<!--{if $_G['group']['maxprice'] && ($_G[gp_action] == 'newthread' || $_G[gp_action] == 'edit' && $isfirstpost)}-->
				<div class="mtm">
					<!--{if $_G['setting']['maxincperthread']}--><img src="{IMGDIR}/arrow_right.gif" />{lang post_price_income_comment}<!--{/if}-->
					<!--{if $_G['setting']['maxchargespan']}--><img src="{IMGDIR}/arrow_right.gif" />{lang post_price_charge_comment}<!--{if $_G[gp_action] == 'edit' && $freechargehours}-->{lang post_price_free_chargehours}<!--{/if}--><!--{/if}-->
				</div>
			<!--{/if}-->

			<!--{if $_G[gp_action] != 'edit' && checkperm('seccode') && ($secqaacheck || $seccodecheck)}-->
				<!--{block sectpl}--><sec> <span id="sec<hash>" onclick="showMenu(this.id);"><sec></span><div id="sec<hash>_menu" class="p_pop p_opt" style="display:none"><sec></div><!--{/block}-->
				<div class="mtm"><!--{template common/seccheck}--></div>
			<!--{/if}-->

			<div class="mtm mbm">
				<!--{if $_G[gp_action] == 'newthread' && $_G['setting']['sitemessage'][newthread] || $_G[gp_action] == 'reply' && $_G['setting']['sitemessage'][reply]}-->
					<span id="custominfo" class="y" style="cursor:pointer">&nbsp;<img src="{IMGDIR}/info_small.gif" alt="{lang faq}" /></span>
				<!--{/if}-->
				<a href="home.php?mod=spacecp&ac=credit&op=rule&fid=$_G['fid']" class="y" target="_blank">{lang post_credits_rule}</a>
				<button type="submit" id="postsubmit" class="pn pnc" value="true" name="{if $_G[gp_action] == 'newthread'}topicsubmit{elseif $_G[gp_action] == 'reply'}replysubmit{elseif $_G[gp_action] == 'edit'}editsubmit{/if}">
				<!--{if $_G[gp_action] == 'newthread'}-->
					<!--{if $special == 0}--><span>{lang post_newthread}</span>
					<!--{elseif $special == 1}--><span>{lang post_newthreadpoll}</span>
					<!--{elseif $special == 2}--><span>{lang post_newthreadtrade}</span>
					<!--{elseif $special == 3}--><span>{lang post_newthreadreward}</span>
					<!--{elseif $special == 4}--><span>{lang post_newthreadactivity}</span>
					<!--{elseif $special == 5}--><span>{lang post_newthreaddebate}</span>
					<!--{elseif $special == 127}-->
						<span><!--{if $buttontext}-->$buttontext<!--{else}-->{lang post_newthread}<!--{/if}--></span>
					<!--{/if}-->
				<!--{elseif $_G[gp_action] == 'reply' && !empty($_G['gp_addtrade'])}--><span>{lang trade_add_post}</span>
				<!--{elseif $_G[gp_action] == 'reply'}--><span>{lang join_thread}</span>
				<!--{elseif $_G[gp_action] == 'edit' && $isfirstpost && $thread['displayorder'] == -4}-->
					<span>{lang post_newthread}</span>
				<!--{elseif $_G[gp_action] == 'edit'}--><span>{lang edit_save}</span>
				<!--{/if}-->
				</button>
				<!--{if $_G['uid']}-->
					<input type="hidden" id="postsave" name="save" value="" />				
					<!--{if $_G[gp_action] == 'newthread' && !$modnewthreads || $_G[gp_action] == 'edit' && $isfirstpost && !$modnewreplies && $thread['displayorder'] == -4}-->
						<button  style="display:none;" type="button" id="postsubmit" class="pn" value="true" onclick="$('postsave').value = 1;$('postsubmit').click();" tabindex="4"><em>{lang save_draft}</em></button>
					<!--{/if}-->
				<!--{/if}-->
				<span style="color:#999; padding:0 5px;vertical-align:middle;">每个贴子最多只能上传三张图片</span>
				<!--{if $special == 2}--><label><input type="checkbox" name="continueadd" value="yes" class="pc" /> {lang post_message2}</label><!--{/if}-->
			</div>

			<!--{if $_G[gp_action] == 'newthread' && $savethreads}-->
				<div class="bm bmn mtm">
					<div class="mbn pbn bbda">
						<a href="home.php?mod=space&uid=$_G['uid']&do=thread&view=me&type=thread&from=&filter=save" class="y xi2">{lang post_message3} &rsaquo;</a>
						<h2>{lang post_message4}<span class="xi1"> $savethreadcount </span>{lang post_message5} <span class="xw0">{lang post_message6}<em class="qsv">&nbsp;</em>{lang post_message7}</span></h2>
					</div>
					<ul>
					<!--{loop $savethreads $savethread}-->
						<li class="mtn"><em class="qsv" title="{lang reply_quote}" onclick="insertsave($savethread[pid])">&nbsp;</em> <a href="forum.php?mod=post&action=edit&fid=$savethread[fid]&tid=$savethread[tid]&pid=$savethread[pid]" class="xi2" target="_blank">$savethread[subject]</a> <span class="xg1">$savethread[dateline]</span></li>
					<!--{/loop}-->
					</ul>
				</div>
			<!--{/if}-->

			<!--{if $_G[gp_action] == 'newthread' && $savethreadothers}-->
				<div class="bm bmn mtm">
					<div class="mbn pbn bbda">
						<a href="home.php?mod=space&uid=$_G['uid']&do=thread&view=me&type=thread&from=&filter=save" class="y xi2">{lang post_message3} &rsaquo;</a>
						<h2>{lang post_message4}<span class="xi1"> $savethreadothercount </span>{lang post_message5} <span class="xw0">{lang post_message6}<em class="qsv">&nbsp;</em>{lang post_message7}</span></h2>
					</div>
					<ul>
						<!--{loop $savethreadothers $savethread}-->
						<li class="mtn"><em class="qsv" title="{lang reply_quote}" onclick="insertsave($savethread[pid])">&nbsp;</em> <a href="forum.php?mod=post&action=edit&fid=$savethread[fid]&tid=$savethread[tid]&pid=$savethread[pid]" class="xi2" target="_blank">$savethread[subject]</a> <span class="xg1">$savethread[dateline]</span></li>
						<!--{/loop}-->
					</ul>
				</div>
			<!--{/if}-->
			
			<!--{if !empty($_G['setting']['pluginhooks']['post_sync_method'])}-->
				<span>
					{lang post_sync_method}:
					<!--{hook/post_sync_method}-->
				</span>
			<!--{/if}-->

			<!--{hook/post_bottom}-->
		

<div id="{$editorid}_menus" class="editorrow" style="overflow: hidden; margin-top: -5px; height: 0; border: none; background: transparent;">
	<!--{subtemplate common/editor_menu}-->
	<!--{subtemplate forum/editor_menu_forum_newimage}-->
</div>

<script type="text/javascript" src="{$_G['setting']['jspath']}calendar.js?{VERHASH}"></script>

<script type="text/javascript">
	var editorsubmit = $('postsubmit');
	var editorform = $('postform');
	var allowpostattach = parseInt('{$_G['group']['allowpostattach']}');
	var allowpostimg = parseInt('$allowpostimg');
	var pid = parseInt('$pid');
	var extensions = '{eval echo str_replace(array('jpeg,','gif,','jpg,','png,') ,'' ,$_G['group']['attachextensions'])}';
	var imgexts = '$imgexts';
	var postminchars = parseInt('$_G['setting']['minpostsize']');
	var postmaxchars = parseInt('$_G['setting']['maxpostsize']');
	var disablepostctrl = parseInt('{$_G['group']['disablepostctrl']}');
	var seccodecheck = parseInt('<!--{if checkperm('seccode') && $seccodecheck}-->1<!--{else}-->0<!--{/if}-->');
	var secqaacheck = parseInt('<!--{if checkperm('seccode') && $secqaacheck}-->1<!--{else}-->0<!--{/if}-->');
	var typerequired = parseInt('{$_G[forum][threadtypes][required]}');
	var sortrequired = parseInt('{$_G[forum][threadsorts][required]}');
	var special = parseInt('$special');
	var isfirstpost = <!--{if $isfirstpost}-->1<!--{else}-->0<!--{/if}-->;
	var allowposttrade = parseInt('{$_G['group']['allowposttrade']}');
	var allowpostreward = parseInt('{$_G['group']['allowpostreward']}');
	var allowpostactivity = parseInt('{$_G['group']['allowpostactivity']}');
	var sortid = parseInt('$sortid');
	var special = parseInt('$special');
	var fid = $_G['fid'];

	<!--{if $isfirstpost && !empty($_G[forum][threadtypes][types])}-->
		simulateSelect('typeid');
	<!--{/if}-->
	<!--{if !$isfirstpost && $thread['special'] == 5 && empty($firststand) && $_G[gp_action] != 'edit'}-->
		simulateSelect('stand');
	<!--{/if}-->
	<!--{if !$special && $_G[forum][threadsorts] && ($_G[gp_action] == 'newthread' || $_G[gp_action] == 'edit' && $isfirstpost && !$thread[sortid])}-->
		simulateSelect('sortid');
		function switchsort() {
			if($('sortid').value) {
				saveData(1);
				<!--{if $isfirstpost && $sortid}-->
					ajaxget('forum.php?mod=post&action=threadsorts&sortid=' + $('sortid').value + '&fid=$_G[fid]<!--{if !empty($modelid)}-->&modelid=$modelid<!--{/if}--><!--{if !empty($_G[gp_modthreadkey])}-->&modthreadkey=$_G[gp_modthreadkey]<!--{/if}-->', 'threadsorts', 'threadsortswait', null, null, function () { seteditorcontrolpos(); });
				<!--{else}-->
					location.href = 'forum.php?mod=post&action=$_G[gp_action]&fid=$_G[fid]<!--{if !empty($_G[tid])}-->&tid=$_G[tid]<!--{/if}--><!--{if !empty($pid)}-->&pid=$pid<!--{/if}--><!--{if !empty($modelid)}-->&modelid=$modelid<!--{/if}-->&extra=$extra<!--{if !$sortid}-->&cedit=yes<!--{/if}-->&sortid=' + $('sortid').value;
				<!--{/if}-->
				Editorwin = 0;
			}
		}
	<!--{/if}-->
	<!--{if $isfirstpost}-->
		<!--{if $sortid}-->
			ajaxget('forum.php?mod=post&action=threadsorts&sortid=$sortid&fid=$_G[fid]<!--{if !empty($_G[tid])}-->&tid=$_G[tid]<!--{/if}-->&inajax=1<!--{if !empty($_G[gp_modthreadkey])}-->&modthreadkey=$_G[gp_modthreadkey]<!--{/if}-->', 'threadsorts', 'threadsortswait', null, null, function () { seteditorcontrolpos(); });
		<!--{elseif $_G['forum']['threadsorts']['required'] && !$special}-->
			<!--{eval $threadsortids = array_keys($threadsorts[types]);}-->
			ajaxget('forum.php?mod=post&action=threadsorts&sortid={$threadsortids[0]}&fid=$_G[fid]<!--{if !empty($_G[tid])}-->&tid=$_G[tid]<!--{/if}-->&inajax=1<!--{if !empty($_G[gp_modthreadkey])}-->&modthreadkey=$_G[gp_modthreadkey]<!--{/if}-->', 'threadsorts', 'threadsortswait', null, null, function () { seteditorcontrolpos(); });
		<!--{/if}-->
	<!--{/if}-->

	<!--{if $_G[gp_action] == 'newthread' && $_G['setting']['sitemessage'][newthread] || $_G[gp_action] == 'reply' && $_G['setting']['sitemessage'][reply]}-->
		showPrompt('custominfo', 'mouseover', '<!--{if $_G[gp_action] == 'newthread'}--><!--{echo trim($_G['setting']['sitemessage'][newthread][array_rand($_G['setting']['sitemessage'][newthread])])}--><!--{elseif $_G[gp_action] == 'reply'}--><!--{echo trim($_G['setting']['sitemessage'][reply][array_rand($_G['setting']['sitemessage'][reply])])}--><!--{/if}-->', $_G['setting']['sitemessage'][time]);
	<!--{/if}-->
	<!--{if $_G['setting']['swfupload'] != 1 && $_G['group']['allowpostattach']}-->addAttach();<!--{/if}-->
	<!--{if $_G['setting']['swfupload'] != 1 && $allowpostimg}-->addAttach('img');<!--{/if}-->

	if($('subjectbox')) {
		var tmp_obj = $('e_textarea');
		if(tmp_obj && tmp_obj.style.display == '') {
			tmp_obj.focus();
		}
	} else if($('subject')) {
		$('subject').focus();
	}
	function uploadsuccess(num,type) {
		//$("uploadtips").style.display = 'block';
		//$("uploadtips").innerHTML="成功上传"+num+" 个 "+(type=='image' ? '图片' : '附件');
		ajaxget('forum.php?mod=ajax&action=imagelist&new_template=1', 'imgattachlist');
		//setTimeout("$('uploadtips').style.display = 'none'",3000);
	}
</script>
<script src="static/js/jquery-1.6.1.min.js" type="text/javascript"></script>
<script type="text/javascript">
jQuery.noConflict();
;(function($){
    $("#psd").hide().css('top','215px').show();
    $("#fujia_tools").click(function(){
        if($("#fujia_tools span").html()=='-'){
            $("#fujia_tools span").html('+');
            $("#fujia_tools").attr('title','点击显示');
            $("#fujia_tools").next().hide();
            $("#fujia_tools").removeClass('bbs pbm mbm');
            $("#ct .mn").css('width',$("#wp").width());
            $("#{$editorid}_iframe").parent().width($("#{$editorid}_iframe").parent().parent().width()-$("#upload_newimage_tools").width()-10);
        }else{
            $("#fujia_tools span").html('-');
            $("#fujia_tools").attr('title','点击隐藏');
            $("#fujia_tools").next().show();
            $("#fujia_tools").addClass('bbs pbm mbm');
            $("#ct .mn").css('width',$("#wp").width()-150);
            $("#{$editorid}_iframe").parent().width($("#{$editorid}_iframe").parent().parent().width()-$("#upload_newimage_tools").width()-10);
        }
    });
    $("#nv_forum").one('mouseover',function(){
        if($("#fujia_tools span").html()=='-'){
            $("#ct .mn").css('width',$("#wp").width()-150);
        }else{
            $("#ct .mn").css('width',$("#wp").width());
        }
        if($("#wp").width()>960){
			$("#stip").css('right','295px');
            $("#psd").css('right','165px');
			if($("#tpflreturn")!=null){$("#tpflreturn").css('right','205px');}
        }else{
			$("#stip").css('right','460px');
            $("#psd").css('right','230px');
			if($("#tpflreturn")!=null){$("#tpflreturn").css('right','375px');}
        }
        $("#{$editorid}_iframe").parent().width($("#{$editorid}_iframe").parent().parent().width()-$("#upload_newimage_tools").width()-10);
    });
    $("#wh").live('click mouseleave',function(){
        if($("#fujia_tools span").html()=='-'){
            $("#ct .mn").css('width',$("#wp").width()-150);
        }else{
            $("#ct .mn").css('width',$("#wp").width());
        }
        if($("#wp").width()>960){
			$("#stip").css('right','295px');
            $("#psd").css('right','165px');
			if($("#tpflreturn")!=null){$("#tpflreturn").css('right','205px');}
        }else{
			$("#stip").css('right','460px');
            $("#psd").css('right','230px');
			if($("#tpflreturn")!=null){$("#tpflreturn").css('right','375px');}
        }
        $("#wp").one('mouseenter',function(){
            if($("#fujia_tools span").html()=='-'){
                $("#ct .mn").css('width',$("#wp").width()-150);
            }else{
                $("#ct .mn").css('width',$("#wp").width());
            }
            if($("#wp").width()>960){
				$("#stip").css('right','295px');
                $("#psd").css('right','165px');
				if($("#tpflreturn")!=null){$("#tpflreturn").css('right','205px');}
            }else{
				$("#stip").css('right','460px');
                $("#psd").css('right','230px');
				if($("#tpflreturn")!=null){$("#tpflreturn").css('right','375px');}
            }
        });
        $("#{$editorid}_iframe").parent().width($("#{$editorid}_iframe").parent().parent().width()-$("#upload_newimage_tools").width()-10);
        change__multi_height();
    });
    
    $("#stip").click(function(){
	$(this).hide();	
    });
    $("#{$editorid}_image").click(function(){
        if($("#upload_newimage_tools").css('display')=='none'){
            $("#upload_newimage_tools").show();
            $("#{$editorid}_iframe").parent().width('75%');
        }else{
            $("#upload_newimage_tools").hide();
            $("#{$editorid}_iframe").width('99%');
            $("#{$editorid}_iframe").parent().width('99%');
        }
    });
    $("#upload_newimage_tools h4 span").click(function(){
        $(this).css({'border-color':'#CCC','border-bottom-color':'#F2F2F2','background':'#F2F2F2'}).siblings().css({'border-color':'#FFF','border-bottom-color':'#CCC','background':'#FFF'}).end().parent().css({'border-bottom-color':'#CCC'}).end();
        var select_mod=$(this).index();
        switch(select_mod){
            case 0:
            var displaymod='multi';
            break;
            case 1:
            var displaymod='albumlist';
            break;
            default:
            return false;
            break;
        }
        $('#{$editorid}_'+displaymod).show().siblings(':not(h4)').hide();
    });
    function change__multi_height(){
        var zong_height=$("#upload_newimage_tools").height();
        var h4_height=$("#upload_newimage_tools :first").outerHeight();
        var multi_height=zong_height-h4_height-20;
        $("#{$editorid}_multi").height(multi_height);
        $("#{$editorid}_imgattachlist").height($("#{$editorid}_multiimg").height()-$("#{$editorid}_multiimg_swf").height());
        var imgattachlist_height=$("#{$editorid}_imgattachlist").height();
        $("#{$editorid}_imgattachlist :first").height(imgattachlist_height-45-5);
        var upfiles_height=$("#{$editorid}_imgattachlist :first").height();
        $("#photolist_upload").height(upfiles_height-30-5);
    }
    $('#photolist_upload tr td').live('mouseleave',function(){
        $(this).children('.delimg_icon').css('visibility','hidden');
    });
    $('#photolist_upload tr td').live('mouseover',function(){
        $(this).children('.delimg_icon').css('visibility','visible');
    });
    $('#upload_newimage_tools img').live('mouseenter',function(){
        $('#img_display_view').remove();
        var img_src=$(this).attr('src');
        if($(this).parents('#albumphoto').attr('id')=='albumphoto' && img_src.indexOf('.thumb.')>=0){
            img_src=img_src.substr(0,(img_src.length-10));
        }
        var off_left=$("#upload_newimage_tools").offset().left-330;
        var off_top=$("#upload_newimage_tools").offset().top+50;
        $("#{$editorid}_body").append("<div id='img_display_view' style='float:right;display:none;border:5px solid #BBB;padding:10px;background:#FFF;position:absolute;top:"+off_top+"px;left:"+off_left+"px;width:150px;height:30px;z-index:999'><div id='tips_loading' style='font-weight:bold;position:inherit;z-index:101;width:150px;height:30px;font-size:16px;line-height:30px;text-align:center;'>正在载入...</div><img src='"+img_src+"' onload=document.getElementById('tips_loading').style.display='none'; style='display:none;float:left;max-width:300px;max-height:300px;position:inherit'/><div>");
        $("#img_display_view img").error(function(){
            var top_error=$("#{$editorid}_body").offset().top+300;
            $(this).prev().text('载入失败').parent().css({'left':'508px','top':top_error}).end().end().remove();
            var parent_width=$('#tips_loading').width();
            var parent_height=$('#tips_loading').height();
            $('#img_display_view').width(parent_width).height(parent_height).fadeIn(500);
        });
        $('#img_display_view img').load(function(){
            var img_width=$('#img_display_view').offset().left+(300-$(this).width());
            $(this).prev().remove().end().parent().css({'left':img_width});
            var parent_width=$(this).width();
            var parent_height=$(this).height();
            $(this).show();
            $('#img_display_view').width(parent_width).height(parent_height).fadeIn(500);
        });
        $("#img_display_view").fadeIn(500);
    });
    $('#upload_newimage_tools img').live('mouseleave',function(){
        $('#img_display_view').remove();
    });
    if(jQuery.browser.webkit || jQuery.browser.opera){
        $("#{$editorid}_multiimg_swf").live('click',function(){
            //$(this).height('150px');
            $("#{$editorid}_multiimg_swf :first").slideUp(300).siblings().show();
            change__multi_height();
        });
        $("#{$editorid}_multiimg_swf").live('mouseenter',function(){
            dis_tips();
            $("#tips_limit").show();
        });
        $("#{$editorid}_imgattachlist").live('click',function(){
            $("#{$editorid}_multiimg_swf").height('52px');
            $("#{$editorid}_multiimg_swf :first").slideDown(300).siblings().hide();
            change__multi_height();
            dis_tips();
            $("#tips_limit").hide();
        });
        $("#upload_newimage_tools").live('mousemove',function(){
            change__multi_height();
        })
    }else{
        $("#{$editorid}_multiimg_swf").live('mouseenter',function(){
            //$(this).height('150px');
            change__multi_height();
            $("#{$editorid}_multiimg_swf :first").slideUp(300).siblings().show();
            dis_tips();
            $("#tips_limit").show();
        });
        $("#{$editorid}_imgattachlist").live('mouseenter',function(){
            $("#{$editorid}_multiimg_swf").height('52px');
            change__multi_height();
            $("#{$editorid}_multiimg_swf :first").slideDown(300).siblings().hide();
        });
    }
    $("#{$editorid}_multiimg_swf").live('mouseleave',function(){
        dis_tips();
        $("#tips_limit").hide();
    });
    function dis_tips(){
        var tips_left=$("#{$editorid}_multiimg_swf").offset().left-$("#tips_limit").width()-20;
        var tips_top=$("#{$editorid}_multiimg_swf").offset().top+20;
        $("#tips_limit").css({"left":tips_left,"top":tips_top});
    }
    $("#insert_all_imagelist").live('click',function(){
        var have_img_len=$("#{$editorid}_iframe").contents().find('body img').length;
        var len_img=$('.imgl td:not(.imgdeleted) img').length;
        if(len_img>3){
            showDialog('你列表中的文件超过三张，超过三张的图片将会保存在列表内，您可以再次发帖时使用！');
        }
        for(i=0;i<(3-have_img_len);i++){
            $('.imgl td:not(.imgdeleted) img:eq('+i+')').click();
            if(have_img_len>0){
                //$("#{$editorid}_iframe").contents().find('body img:last').before('<br/>');
            }else{
                if(i>=1){
                    //$("#{$editorid}_iframe").contents().find('body img:last').before('<br/>');
                }
            }
        }
    });
    $("#all_insert_alb").live('click',function(){
        $("#photolist_upload input:checkbox").click();
        if($("#photolist_upload input:hidden.pc").val()=="" && $("#all_insert_alb").attr('checked')=='checked'){
            $("#photolist_upload input:checkbox").click();
        }
    });
    $("#{$editorid}_fullswitcher").live('mouseenter',function(){
        $("#e_iframe").parent().width("75%");
        $(".area").one('mouseover mousemove',function(){
            change__multi_height();
        });
    });
    $("#save_to_album").click(function(){
        $("#album_contrl").toggle();
    });
    function img_width_fix(){
        $("#{$editorid}_iframe").contents().find('body').children('img').load(function(){
            $(this).removeAttr('width');
        });
    }
    img_width_fix();
    if($.browser.msie){
        $("#{$editorid}_iframe").one("mousemove",function(){
            img_width_fix();
        });
    }
    $("#{$editorid}_multiimg_swf :eq(1)").hide();
    $("#upload_newimage_tools h4 span:first").click();
    $('#fujia_tools').click();
    $("#{$editorid}_multiimg_swf").click();
    change__multi_height();
})(jQuery);
</script>
